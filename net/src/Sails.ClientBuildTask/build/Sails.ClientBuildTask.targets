<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--Defining all the text files input parameters-->
  <ItemGroup>
    <IdlFiles Include="$(RootFolder)\**\*.$(IdlExtensionFile)" />
  </ItemGroup>

  <!--It is generated a target which is executed before the compilation-->
  <Target Name="BeforeCompile" Inputs="@(IdlFiles)" Outputs="@(IdlGeneratedFiles)">
    <!--Calling our custom task-->
    <Sails.ClientBuildTask NamespaceName="$(IdlGeneratedNamespace)" IdlFiles="@(IdlFiles)">
      <Output TaskParameter="IdlGeneratedFiles" PropertyName="IdlGeneratedFiles" />
    </Sails.ClientBuildTask>
    <!--Our generated file is included to be compiled-->
    <ItemGroup>
      <Compile Remove="@(IdlGeneratedFiles)" />
      <Compile Include="@(IdlGeneratedFiles)" />
    </ItemGroup>
  </Target>

  <!--The generated file is deleted after a general clean. It will force the regeneration on rebuild-->
  <Target Name="AfterClean">
    <Delete Files="@(IdlGeneratedFiles)" />
  </Target>
</Project>
