<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--Defining all the text files input parameters-->
  <ItemGroup>
    <IdlFiles Include="**\*.$(IdlExtensionFile)" />
  </ItemGroup>

  <!--It is generated a target which is executed before the compilation-->
  <Target Name="SailsIdlGenerate" BeforeTargets="BeforeCompile">
    <!--Calling our custom task-->
    <SailsIdl IdlNamespace="$(IdlNamespace)" IdlFiles="@(IdlFiles)">
      <Output TaskParameter="IdlGeneratedFiles" ItemName="IdlGeneratedFiles" />
    </SailsIdl>
    <!--Our generated file is included to be compiled-->
    <ItemGroup>
      <Compile Remove="@(IdlGeneratedFiles)" />
      <Compile Include="@(IdlGeneratedFiles)" />
    </ItemGroup>
  </Target>

  <!--The generated file is deleted after a general clean. It will force the regeneration on rebuild-->
  <Target Name="SailsIdlClean" AfterTargets="AfterClean" >
    <ItemGroup>
      <FilesToDelete Include="**\*.$(IdlExtensionFile).generated.cs"/>
    </ItemGroup>
    <Delete Files="@(FilesToDelete)">
      <Output TaskParameter="DeletedFiles" ItemName="FilesDeleted" />
    </Delete>
    <Message Text="Deleted: @(FilesDeleted)"/>
  </Target>
</Project>
