name: '[net] Release'

on:
  push:
    tags:
      - 'net/v*-pin'

jobs:
  build_win_x64:
    name: Build Native Libraries for Win x64
    runs-on: windows-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build Client Generator
        run: |
            cargo build --manifest-path net/rs/Cargo.toml --release

      - name: Upload Client Generator Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: win_x64
          path: ./net/rs/target/release/sails_net_client_gen.dll

  build_linux_x64:
    name: Build Native Libraries for Linux x64
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build Client Generator
        run: |
            cargo build --manifest-path net/rs/Cargo.toml --release

      - name: Upload Client Generator Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: linux_x64
          path: ./net/rs/target/release/libsails_net_client_gen.so

  osx_x64:
    name: Build Native Libraries for NacOS x64
    runs-on: macos-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build Client Generator
        run: |
            rustup target add x86_64-apple-darwin
            cargo build --manifest-path net/rs/Cargo.toml --release --target x86_64-apple-darwin

      - name: Upload Client Generator Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: osx_x64
          path: ./net/rs/target/x86_64-apple-darwin/release/libsails_net_client_gen.dylib

  osx_arm64:
    name: Build Native Libraries for MacOS ARM64
    runs-on: macos-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build Client Generator
        run: |
            rustup target add aarch64-apple-darwin
            cargo build --manifest-path net/rs/Cargo.toml --release --target aarch64-apple-darwin

      - name: Upload Client Generator Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: osx_arm64
          path: ./net/rs/target/aarch64-apple-darwin/release/libsails_net_client_gen.dylib

  prepare:
    name: Prepare Release
    runs-on: ubuntu-latest
    permissions:
      contents: write
    defaults:
      run:
        shell: bash

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
