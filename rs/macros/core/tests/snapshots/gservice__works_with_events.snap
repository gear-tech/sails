---
source: rs/macros/core/tests/gservice.rs
expression: result
---
impl SomeService {
    pub fn do_this(&mut self) -> u32 {
        42
    }
    pub fn this(&self) -> bool {
        true
    }
    fn notify_on(&mut self, event: SomeEvents) -> sails_rs::errors::Result<()> {
        #[cfg(not(target_arch = "wasm32"))]
        {
            let self_ptr = self as *const _ as usize;
            let event_listeners = sails_rs::gstd::events::event_listeners().lock();
            if let Some(event_listener_ptr) = event_listeners.get(&self_ptr) {
                let event_listener = unsafe {
                    &mut *(*event_listener_ptr as *mut Box<dyn FnMut(&SomeEvents)>)
                };
                core::mem::drop(event_listeners);
                event_listener(&event);
            }
        }
        sails_rs::gstd::events::__notify_on(event)
    }
}
#[allow(async_fn_in_trait)]
pub trait SomeServiceImplTrait {
    fn do_this(&mut self) -> u32;
    fn this(&self) -> bool;
}
impl SomeServiceImplTrait
for sails_rs::gstd::services::ServiceExposure<SomeService, ()> {
    fn do_this(&mut self) -> u32 {
        let exposure_scope = sails_rs::gstd::services::ExposureCallScope::new2(self);
        self.inner.do_this()
    }
    fn this(&self) -> bool {
        let exposure_scope = sails_rs::gstd::services::ExposureCallScope::new2(self);
        self.inner.this()
    }
}
impl sails_rs::gstd::services::ServiceHandle for SomeService {
    async fn try_handle(&mut self, input: &[u8]) -> Option<(Vec<u8>, u128)> {
        let mut __input = input;
        let route: String = sails_rs::Decode::decode(&mut __input).ok()?;
        match route.as_str() {
            "DoThis" => {
                let request: some_service_meta::__DoThisParams = sails_rs::Decode::decode(
                        &mut __input,
                    )
                    .expect("Failed to decode request");
                let result = self.do_this();
                let value = 0u128;
                Some((sails_rs::Encode::encode(&("DoThis", &result)), value))
            }
            "This" => {
                let request: some_service_meta::__ThisParams = sails_rs::Decode::decode(
                        &mut __input,
                    )
                    .expect("Failed to decode request");
                let result = self.this();
                let value = 0u128;
                Some((sails_rs::Encode::encode(&("This", &result)), value))
            }
            _ => None,
        }
    }
}
impl sails_rs::gstd::services::Service for SomeService {
    type Exposure = sails_rs::gstd::services::ServiceExposure<SomeService, ()>;
    type Extend = ();
    fn expose(
        self,
        message_id: sails_rs::MessageId,
        route: &'static [u8],
    ) -> Self::Exposure {
        let extend = ();
        Self::Exposure::new(message_id, route, self, extend)
    }
}
impl sails_rs::meta::ServiceMeta for SomeService {
    fn commands() -> sails_rs::scale_info::MetaType {
        sails_rs::scale_info::MetaType::new::<some_service_meta::CommandsMeta>()
    }
    fn queries() -> sails_rs::scale_info::MetaType {
        sails_rs::scale_info::MetaType::new::<some_service_meta::QueriesMeta>()
    }
    fn events() -> sails_rs::scale_info::MetaType {
        sails_rs::scale_info::MetaType::new::<some_service_meta::EventsMeta>()
    }
    fn base_services() -> impl Iterator<Item = sails_rs::meta::AnyServiceMeta> {
        [].into_iter()
    }
}
mod some_service_meta {
    use super::*;
    use sails_rs::{Decode, TypeInfo};
    #[derive(Decode, TypeInfo)]
    #[codec(crate = sails_rs::scale_codec)]
    #[scale_info(crate = sails_rs::scale_info)]
    pub struct __DoThisParams {}
    #[derive(Decode, TypeInfo)]
    #[codec(crate = sails_rs::scale_codec)]
    #[scale_info(crate = sails_rs::scale_info)]
    pub struct __ThisParams {}
    #[derive(TypeInfo)]
    #[scale_info(crate = sails_rs::scale_info)]
    pub enum CommandsMeta {
        DoThis(__DoThisParams, u32),
    }
    #[derive(TypeInfo)]
    #[scale_info(crate = sails_rs::scale_info)]
    pub enum QueriesMeta {
        This(__ThisParams, bool),
    }
    #[derive(TypeInfo)]
    #[scale_info(crate = sails_rs::scale_info)]
    pub enum NoEvents {}
    pub type EventsMeta = SomeEvents;
}
